<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Players Monthly Fee Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4b6cb7;
            --primary-dark: #3a5795;
            --secondary-color: #182848;
            --light-bg: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #333;
            --text-light: #555;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --border-color: #ddd;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 10px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 15px 0;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            padding: 0 10px;
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
            padding: 0 10px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f4ff;
            font-size: 1.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .card-action-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.3s;
        }

        .card-action-btn:hover {
            background: var(--primary-dark);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .form-group input, 
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, 
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            width: 100%;
        }

        button:hover {
            background: var(--primary-dark);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        table th, 
        table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        table th {
            background-color: #f8f9ff;
            font-weight: 600;
            color: var(--primary-color);
        }

        table tr:hover {
            background-color: #f9fbfd;
        }

        .status-paid {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-pending {
            color: var(--danger-color);
            font-weight: 600;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .summary-card h3 {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 8px;
        }

        .summary-card .value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .summary-card i {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-edit, 
        .btn-delete,
        .btn-contact {
            padding: 6px 10px;
            font-size: 0.8rem;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-edit {
            background: var(--warning-color);
        }

        .btn-delete {
            background: var(--danger-color);
        }

        .btn-contact {
            background: var(--info-color);
        }

        .export-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
            border: 1px dashed var(--primary-color);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: var(--info-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            opacity: 0.9;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .time-slot {
            background: #f8f9ff;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #eaeef7;
        }

        .time-slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .time-slot-title {
            font-weight: 600;
            color: var(--primary-color);
        }

        .time-slot-days {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .time-slot-time {
            font-size: 0.9rem;
        }

        /* Mobile-specific styles */
        @media (max-width: 992px) {
            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .summary-card {
                padding: 12px;
            }
            
            .summary-card .value {
                font-size: 1.2rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .card h2 {
                font-size: 1.2rem;
            }
            
            table th, 
            table td {
                padding: 8px 10px;
            }

            .export-buttons {
                flex-direction: column;
            }
            
            .time-slots {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.3rem;
            }
            
            header p {
                font-size: 0.9rem;
            }
            
            .summary-card h3 {
                font-size: 0.8rem;
            }
            
            .summary-card .value {
                font-size: 1.1rem;
            }
            
            .form-group label {
                font-size: 0.85rem;
            }
            
            .form-group input, 
            .form-group select,
            .form-group textarea {
                padding: 8px 10px;
            }
            
            button {
                padding: 8px 12px;
                font-size: 0.9rem;
            }

            .card-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-graduation-cap"></i> Players Monthly Fee Tracker</h1>
            <p>Manage and track player fees efficiently</p>
        </header>
        
        <div class="summary-cards">
            <div class="summary-card">
                <i class="fas fa-users"></i>
                <h3>Total Players</h3>
                <div class="value" id="total-students">0</div>
            </div>
            <div class="summary-card">
                <i class="fas fa-money-bill-wave"></i>
                <h3>Monthly Revenue</h3>
                <div class="value" id="monthly-revenue">৳0</div>
            </div>
            <div class="summary-card">
                <i class="fas fa-calendar-check"></i>
                <h3>Paid This Month</h3>
                <div class="value" id="paid-this-month">৳0</div>
            </div>
            <div class="summary-card">
                <i class="fas fa-phone"></i>
                <h3>Contacted Today</h3>
                <div class="value" id="contacted-today">0</div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h2>
                    <span><i class="fas fa-user-plus"></i> Add New Player</span>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="FeeTrackerApp.exportData('students')">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </h2>
                <form id="student-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">Player Name *</label>
                            <input type="text" id="name" required placeholder="Enter full name">
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" id="phone" required placeholder="Enter phone number">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="monthly-fee">Monthly Fee (৳) *</label>
                            <input type="number" id="monthly-fee" required placeholder="Enter monthly fee amount">
                        </div>
                        <div class="form-group">
                            <label for="start-date">Start Date *</label>
                            <input type="date" id="start-date" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="time-slots">Training Time Slots</label>
                        <div class="time-slots">
                            <div class="time-slot">
                                <div class="time-slot-header">
                                    <span class="time-slot-title">Morning Session</span>
                                    <span class="time-slot-days">Mon, Wed, Fri</span>
                                </div>
                                <div class="time-slot-time">7:00 AM - 9:00 AM</div>
                            </div>
                            <div class="time-slot">
                                <div class="time-slot-header">
                                    <span class="time-slot-title">Evening Session</span>
                                    <span class="time-slot-days">Tue, Thu, Sat</span>
                                </div>
                                <div class="time-slot-time">5:00 PM - 7:00 PM</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="time-slot">Preferred Time Slot *</label>
                        <select id="time-slot" required>
                            <option value="">Select a time slot</option>
                            <option value="morning">Morning (7:00 AM - 9:00 AM)</option>
                            <option value="evening">Evening (5:00 PM - 7:00 PM)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" rows="2" placeholder="Any special notes about the player"></textarea>
                    </div>
                    
                    <button type="submit" id="student-submit-btn">Add Player</button>
                </form>
            </div>
            
            <div class="card">
                <h2>
                    <span><i class="fas fa-file-invoice-dollar"></i> Record Payment</span>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="FeeTrackerApp.exportData('payments')">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </h2>
                <form id="payment-form">
                    <div class="form-group">
                        <label for="student">Select Player *</label>
                        <select id="student" required>
                            <option value="">Select a Player</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payment-date">Payment Date *</label>
                            <input type="date" id="payment-date" required>
                        </div>
                        <div class="form-group">
                            <label for="payment-time">Payment Time</label>
                            <input type="time" id="payment-time" value="12:00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="amount">Amount (৳) *</label>
                        <input type="number" id="amount" required placeholder="Enter payment amount">
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-method">Payment Method *</label>
                        <select id="payment-method" required>
                            <option value="">Select payment method</option>
                            <option value="cash">Cash</option>
                            <option value="bank">Bank Transfer</option>
                            <option value="mobile">Mobile Banking</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <button type="submit">Record Payment</button>
                </form>
            </div>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-list"></i> Player List</h2>
            <div class="table-container">
                <table id="students-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Monthly Fee</th>
                            <th>Time Slot</th>
                            <th>Start Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Student data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-history"></i> Payment History</h2>
            <div class="table-container">
                <table id="payments-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Player</th>
                            <th>Phone</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Month</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Payment data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="export-section">
            <h3><i class="fas fa-database"></i> Data Export</h3>
            <p>Export all your data for backup or analysis</p>
            <div class="export-buttons">
                <button class="export-btn" onclick="FeeTrackerApp.exportData('all')">
                    <i class="fas fa-file-export"></i> Export All Data
                </button>
                <button class="export-btn" onclick="FeeTrackerApp.exportData('students')">
                    <i class="fas fa-users"></i> Export Players Only
                </button>
                <button class="export-btn" onclick="FeeTrackerApp.exportData('payments')">
                    <i class="fas fa-receipt"></i> Export Payments Only
                </button>
                <button class="export-btn" onclick="FeeTrackerApp.importData()">
                    <i class="fas fa-file-import"></i> Import Data
                </button>
            </div>
        </div>
    </div>

    <script>
        // App namespace to avoid global variables
        const FeeTrackerApp = {
            // Data storage
            students: JSON.parse(localStorage.getItem('students')) || [],
            payments: JSON.parse(localStorage.getItem('payments')) || [],
            editId: null,
            
            // DOM Elements
            elements: {
                studentForm: document.getElementById('student-form'),
                paymentForm: document.getElementById('payment-form'),
                studentSelect: document.getElementById('student'),
                studentsTable: document.getElementById('students-table').querySelector('tbody'),
                paymentsTable: document.getElementById('payments-table').querySelector('tbody'),
                studentSubmitBtn: document.getElementById('student-submit-btn'),
                totalStudents: document.getElementById('total-students'),
                monthlyRevenue: document.getElementById('monthly-revenue'),
                paidThisMonth: document.getElementById('paid-this-month'),
                contactedToday: document.getElementById('contacted-today')
            },
            
            // Initialize the application
            init: function() {
                this.setupEventListeners();
                this.populateStudentDropdown();
                this.renderStudentsTable();
                this.renderPaymentsTable();
                this.updateSummary();
                this.setDefaultDates();
            },
            
            // Set up event listeners
            setupEventListeners: function() {
                this.elements.studentForm.addEventListener('submit', (e) => this.handleStudentFormSubmit(e));
                this.elements.paymentForm.addEventListener('submit', (e) => this.handlePaymentFormSubmit(e));
            },
            
            // Set default dates in form inputs
            setDefaultDates: function() {
                const today = new Date().toISOString().split('T')[0];
                const now = new Date();
                const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                document.getElementById('start-date').value = today;
                document.getElementById('payment-date').value = today;
                document.getElementById('payment-time').value = time;
            },
            
            // Update summary cards
            updateSummary: function() {
                this.elements.totalStudents.textContent = this.students.length;
                
                const monthlyRevenue = this.students.reduce((total, student) => 
                    total + parseFloat(student.monthlyFee), 0);
                this.elements.monthlyRevenue.textContent = `৳${monthlyRevenue.toFixed(2)}`;
                
                const currentMonth = new Date().toISOString().slice(0, 7);
                const paidThisMonth = this.payments
                    .filter(payment => payment.date.startsWith(currentMonth))
                    .reduce((sum, payment) => sum + parseFloat(payment.amount), 0);
                
                this.elements.paidThisMonth.textContent = `৳${paidThisMonth.toFixed(2)}`;
                
                // Calculate contacted today
                const today = new Date().toISOString().split('T')[0];
                const contactedToday = this.students.filter(student => {
                    return student.lastContacted === today;
                }).length;
                
                this.elements.contactedToday.textContent = contactedToday;
            },
            
            // Populate student dropdown
            populateStudentDropdown: function() {
                this.elements.studentSelect.innerHTML = '<option value="">Select a player</option>';
                
                this.students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.phone}) - ৳${student.monthlyFee}`;
                    this.elements.studentSelect.appendChild(option);
                });
            },
            
            // Render students table
            renderStudentsTable: function() {
                this.elements.studentsTable.innerHTML = '';
                const currentMonth = new Date().toISOString().slice(0, 7);
                
                this.students.forEach(student => {
                    const hasPaid = this.payments.some(payment => 
                        payment.studentId === student.id && 
                        payment.date.startsWith(currentMonth)
                    );
                    
                    const timeSlotText = student.timeSlot === 'morning' ? 
                        'Morning (7-9 AM)' : 'Evening (5-7 PM)';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.phone}</td>
                        <td>৳${student.monthlyFee}</td>
                        <td>${timeSlotText}</td>
                        <td>${this.formatDate(student.startDate)}</td>
                        <td class="${hasPaid ? 'status-paid' : 'status-pending'}">
                            ${hasPaid ? 'Paid' : 'Pending'}
                        </td>
                        <td class="action-buttons">
                            <button class="btn-edit" onclick="FeeTrackerApp.editStudent(${student.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-delete" onclick="FeeTrackerApp.deleteStudent(${student.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn-contact" onclick="FeeTrackerApp.contactStudent(${student.id})">
                                <i class="fas fa-phone"></i>
                            </button>
                        </td>
                    `;
                    
                    this.elements.studentsTable.appendChild(row);
                });
            },
            
            // Render payments table
            renderPaymentsTable: function() {
                this.elements.paymentsTable.innerHTML = '';
                const sortedPayments = [...this.payments].sort((a, b) => 
                    new Date(b.date + 'T' + b.time) - new Date(a.date + 'T' + a.time));
                
                sortedPayments.forEach(payment => {
                    const student = this.students.find(s => s.id === payment.studentId);
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${this.formatDate(payment.date)} ${payment.time || ''}</td>
                        <td>${student ? student.name : 'Unknown'}</td>
                        <td>${student ? student.phone : 'N/A'}</td>
                        <td>৳${payment.amount}</td>
                        <td>${payment.method}</td>
                        <td>${payment.date.slice(0, 7)}</td>
                    `;
                    
                    this.elements.paymentsTable.appendChild(row);
                });
            },
            
            // Format date for display
            formatDate: function(dateString) {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            },
            
            // Handle student form submission
            handleStudentFormSubmit: function(event) {
                event.preventDefault();
                
                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                const monthlyFee = parseFloat(document.getElementById('monthly-fee').value);
                const startDate = document.getElementById('start-date').value;
                const timeSlot = document.getElementById('time-slot').value;
                const notes = document.getElementById('notes').value;
                
                if (this.editId) {
                    // Update existing student
                    const index = this.students.findIndex(student => student.id === this.editId);
                    this.students[index] = { 
                        ...this.students[index], 
                        name, 
                        phone,
                        monthlyFee, 
                        startDate,
                        timeSlot,
                        notes
                    };
                    
                    alert("Player updated successfully!");
                    this.editId = null;
                    this.elements.studentSubmitBtn.textContent = "Add Player";
                } else {
                    // Add new student
                    const newStudent = {
                        id: this.students.length ? Math.max(...this.students.map(s => s.id)) + 1 : 1,
                        name,
                        phone,
                        monthlyFee,
                        startDate,
                        timeSlot,
                        notes,
                        lastContacted: null
                    };
                    
                    this.students.push(newStudent);
                    alert("Player added successfully!");
                }
                
                this.saveData();
                this.populateStudentDropdown();
                this.renderStudentsTable();
                this.updateSummary();
                this.elements.studentForm.reset();
                this.setDefaultDates();
            },
            
            // Handle payment form submission
            handlePaymentFormSubmit: function(event) {
                event.preventDefault();
                
                const studentId = parseInt(this.elements.studentSelect.value);
                const date = document.getElementById('payment-date').value;
                const time = document.getElementById('payment-time').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const method = document.getElementById('payment-method').value;
                
                if (!studentId) {
                    alert('Please select a player');
                    return;
                }
                
                const newPayment = {
                    id: this.payments.length ? Math.max(...this.payments.map(p => p.id)) + 1 : 1,
                    studentId,
                    date,
                    time,
                    amount,
                    method
                };
                
                this.payments.push(newPayment);
                this.saveData();
                
                this.renderPaymentsTable();
                this.renderStudentsTable();
                this.updateSummary();
                this.elements.paymentForm.reset();
                this.setDefaultDates();
            },
            
            // Save data to localStorage
            saveData: function() {
                localStorage.setItem('students', JSON.stringify(this.students));
                localStorage.setItem('payments', JSON.stringify(this.payments));
            },
            
            // Edit student
            editStudent: function(id) {
                const student = this.students.find(s => s.id === id);
                if (!student) return;
                
                document.getElementById('name').value = student.name;
                document.getElementById('phone').value = student.phone;
                document.getElementById('monthly-fee').value = student.monthlyFee;
                document.getElementById('start-date').value = student.startDate;
                document.getElementById('time-slot').value = student.timeSlot;
                document.getElementById('notes').value = student.notes || '';
                
                this.editId = id;
                this.elements.studentSubmitBtn.textContent = "Update Player";
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },
            
            // Delete student
            deleteStudent: function(id) {
                if (!confirm("Are you sure you want to delete this player?")) return;
                
                this.students = this.students.filter(student => student.id !== id);
                this.payments = this.payments.filter(payment => payment.studentId !== id);
                
                this.saveData();
                this.renderStudentsTable();
                this.renderPaymentsTable();
                this.updateSummary();
                this.populateStudentDropdown();
            },
            
            // Contact student
            contactStudent: function(id) {
                const student = this.students.find(s => s.id === id);
                if (!student) return;
                
                const today = new Date().toISOString().split('T')[0];
                student.lastContacted = today;
                
                this.saveData();
                this.renderStudentsTable();
                this.updateSummary();
                
                alert(`Contacted ${student.name} at ${student.phone}`);
            },

            // Export data to CSV
            exportData: function(type) {
                let csvContent = "";
                let filename = "";
                
                if (type === 'students' || type === 'all') {
                    // Students CSV
                    csvContent += "ID,Name,Phone,Monthly Fee,Time Slot,Start Date,Last Contacted,Notes\n";
                    this.students.forEach(student => {
                        const timeSlotText = student.timeSlot === 'morning' ? 
                            'Morning (7-9 AM)' : 'Evening (5-7 PM)';
                        csvContent += `${student.id},${student.name},${student.phone},${student.monthlyFee},${timeSlotText},${student.startDate},${student.lastContacted || ''},"${student.notes || ''}"\n`;
                    });
                    
                    if (type === 'students') {
                        this.downloadCSV(csvContent, 'players_data.csv');
                        return;
                    } else {
                        csvContent += "\n\n"; // Add separation between data types
                    }
                }
                
                if (type === 'payments' || type === 'all') {
                    // Payments CSV
                    csvContent += "Date,Time,Player ID,Player Name,Player Phone,Amount,Method,Month\n";
                    this.payments.forEach(payment => {
                        const student = this.students.find(s => s.id === payment.studentId);
                        const studentName = student ? student.name : 'Unknown';
                        const studentPhone = student ? student.phone : 'N/A';
                        csvContent += `${payment.date},${payment.time || ''},${payment.studentId},${studentName},${studentPhone},${payment.amount},${payment.method},${payment.date.slice(0, 7)}\n`;
                    });
                    
                    filename = type === 'all' ? 'all_data.csv' : 'payments_data.csv';
                    this.downloadCSV(csvContent, filename);
                }
            },

            // Download CSV file
            downloadCSV: function(csvContent, filename) {
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert(`Data exported successfully as ${filename}`);
            },

            // Import data (basic implementation)
            importData: function() {
                alert("Import functionality would allow you to upload CSV files to restore your data. This is a more advanced feature that would require additional implementation.");
            }
        };

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            FeeTrackerApp.init();
        });
    </script>
</body>
</html>